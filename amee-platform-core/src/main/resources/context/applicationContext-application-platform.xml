<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
                           http://www.springframework.org/schema/beans/spring-beans-3.1.xsd">

    <bean id="platformApplication" class="org.restlet.Application">
        <property name="root" ref="platformRoot"/>
        <property name="tunnelService.methodTunnel" value="true"/>
        <property name="tunnelService.extensionsTunnel" value="true"/>
        <property name="statusService" ref="ameeStatusService"/>
        <property name="name" value="Platform Application"/>
    </bean>

    <bean id="platformRoot" class="org.restlet.ext.spring.SpringRouter">
        <constructor-arg ref="platformApplication"/>
        <property name="attachments">
            <map>
                <entry key="">
                    <bean class="com.amee.restlet.AMEERequestFilter">
                        <property name="next">
                            <bean class="com.amee.restlet.SiteFilter">
                                <property name="next">
                                    <bean class="com.amee.platform.restlet.CollectCredentialsGuard">
                                        <constructor-arg index="0" ref="platformApplication"/>
                                        <constructor-arg index="1" ref="authenticationServiceImpl"/>
                                        <property name="next" ref="versionsRouter"/>
                                    </bean>
                                </property>
                            </bean>
                        </property>
                    </bean>
                </entry>
            </map>
        </property>
    </bean>

    <bean id="versionsRouter" class="org.restlet.ext.spring.SpringRouter">
        <constructor-arg ref="platformApplication"/>
        <property name="attachments">
            <map>
                <entry key="/{version}">
                    <bean class="com.amee.restlet.version.VersionFilter">
                        <property name="next" ref="platformRouter"/>
                    </bean>
                </entry>
            </map>
        </property>
    </bean>

    <bean id="platformRouter" class="com.amee.restlet.version.VersionSpringRouter">
        <constructor-arg ref="platformApplication"/>
        <property name="attachments">
            <map>
                <entry key="/categories" value-ref="categoriesRouter"/>
                <entry key="/definitions" value-ref="definitionsRouter"/>
                <entry key="/profiles" value-ref="profilesRouter"/>
                <entry key="/search" value-ref="searchRouter"/>
                <entry key="/tags" value-ref="tagsRouter"/>
                <entry key="/units" value-ref="unitsRouter"/>
            </map>
        </property>
    </bean>

    <!-- Categories -->
    <bean id="categoriesRouter" class="com.amee.restlet.version.VersionSpringRouter">
        <constructor-arg ref="platformApplication"/>
        <property name="defaultMatchingMode" ref="modeStartsWith"/>
        <property name="defaultMatchQuery" value="false"/>
        <property name="attachments">
            <map>
                <entry key="">
                    <bean class="com.amee.restlet.version.VersionFinder">
                        <lookup-method name="createResource" bean="dataCategoriesResource"/>
                        <property name="since" value="3.0.0"/>
                    </bean>
                </entry>
                <entry key="/{categoryIdentifier}">
                    <bean class="com.amee.restlet.version.VersionFinder">
                        <lookup-method name="createResource" bean="dataCategoryResource"/>
                        <property name="since" value="3.0.0"/>
                    </bean>
                </entry>
                <entry key="/{categoryIdentifier}/calculation">
                    <bean class="com.amee.restlet.version.VersionFinder">
                        <lookup-method name="createResource" bean="dataItemCalculationResource"/>
                        <property name="since" value="3.6.0"/>
                    </bean>
                </entry>
                <entry key="/{categoryIdentifier}/items">
                    <bean class="com.amee.restlet.version.VersionFinder">
                        <lookup-method name="createResource" bean="dataItemsResource"/>
                        <property name="since" value="3.0.0"/>
                    </bean>
                </entry>
                <entry key="/{categoryIdentifier}/items/{itemIdentifier}">
                    <bean class="com.amee.restlet.version.VersionFinder">
                        <lookup-method name="createResource" bean="dataItemResource"/>
                        <property name="since" value="3.0.0"/>
                    </bean>
                </entry>
                <entry key="/{categoryIdentifier}/items/{itemIdentifier}/calculation">
                    <bean class="com.amee.restlet.version.VersionFinder">
                        <lookup-method name="createResource" bean="dataItemCalculationResource"/>
                        <property name="since" value="3.4.0"/>
                    </bean>
                </entry>
                <entry key="/{categoryIdentifier}/items/{itemIdentifier}/values">
                    <bean class="com.amee.restlet.version.VersionFinder">
                        <lookup-method name="createResource" bean="dataItemValuesResource"/>
                        <property name="since" value="3.4.0"/>
                    </bean>
                </entry>
                <entry key="/{categoryIdentifier}/items/{itemIdentifier}/values/{valuePath}">
                    <bean class="com.amee.restlet.version.VersionFinder">
                        <lookup-method name="createResource" bean="dataItemValueHistoryResource"/>
                        <property name="since" value="3.4.0"/>
                    </bean>
                </entry>
                <entry key="/{categoryIdentifier}/items/{itemIdentifier}/values/{valuePath}/{itemValueIdentifier}">
                    <bean class="com.amee.restlet.version.VersionFinder">
                        <lookup-method name="createResource" bean="dataItemValueResource"/>
                        <property name="since" value="3.4.0"/>
                    </bean>
                </entry>
                <entry key="/{categoryIdentifier}/tags" value-ref="tagsRouter"/>
                <entry key="/{categoryIdentifier}/drill">
                    <bean class="com.amee.restlet.version.VersionFinder">
                        <lookup-method name="createResource" bean="drillResource"/>
                        <property name="since" value="3.3.0"/>
                    </bean>
                </entry>
            </map>
        </property>
    </bean>

    <bean id="dataCategoriesResource" class="com.amee.restlet.resource.GenericResource" scope="prototype">
        <property name="modifiable" value="true"/>
        <property name="allowDelete" value="false"/>
        <property name="allowPost" value="true"/>
        <property name="allowPut" value="false"/>
        <property name="lastSegment" value="categories"/>
        <property name="attributeNames">
            <set>
                <value>activeUserUid</value>
            </set>
        </property>
        <property name="builder">
            <bean class="com.amee.base.resource.LocalResourceBuilder">
                <property name="target"
                          value="com.amee.platform.resource.datacategory.DataCategoriesResource$Builder"/>
            </bean>
        </property>
        <property name="acceptors">
            <map>
                <entry key="application/x-www-form-urlencoded">
                    <bean class="com.amee.base.resource.LocalResourceAcceptor">
                        <property name="target"
                                  value="com.amee.platform.resource.datacategory.DataCategoriesResource$FormAcceptor"/>
                    </bean>
                </entry>
            </map>
        </property>
    </bean>

    <bean id="dataCategoryResource" class="com.amee.restlet.resource.GenericResource" scope="prototype">
        <property name="modifiable" value="true"/>
        <property name="allowPost" value="false"/>
        <property name="attributeNames">
            <set>
                <value>activeUserUid</value>
                <value>categoryIdentifier</value>
            </set>
        </property>
        <property name="builder">
            <bean class="com.amee.base.resource.LocalResourceBuilder">
                <property name="target"
                          value="com.amee.platform.resource.datacategory.DataCategoryResource$Builder"/>
            </bean>
        </property>
        <property name="acceptors">
            <map>
                <entry key="application/x-www-form-urlencoded">
                    <bean class="com.amee.base.resource.LocalResourceAcceptor">
                        <property name="target"
                                  value="com.amee.platform.resource.datacategory.DataCategoryResource$FormAcceptor"/>
                    </bean>
                </entry>
            </map>
        </property>
        <property name="remover">
            <bean class="com.amee.base.resource.LocalResourceRemover">
                <property name="target"
                          value="com.amee.platform.resource.datacategory.DataCategoryResource$Remover"/>
            </bean>
        </property>
    </bean>

    <bean id="dataItemsResource" class="com.amee.restlet.resource.GenericResource" scope="prototype">
        <property name="modifiable" value="true"/>
        <property name="allowDelete" value="false"/>
        <property name="allowPost" value="true"/>
        <property name="allowPut" value="false"/>
        <property name="lastSegment" value="items"/>
        <property name="attributeNames">
            <set>
                <value>activeUserUid</value>
                <value>categoryIdentifier</value>
            </set>
        </property>
        <property name="builder">
            <bean class="com.amee.base.resource.LocalResourceBuilder">
                <property name="target"
                          value="com.amee.platform.resource.dataitem.DataItemsResource$Builder"/>
            </bean>
        </property>
        <property name="acceptors">
            <map>
                <entry key="application/x-www-form-urlencoded">
                    <bean class="com.amee.base.resource.LocalResourceAcceptor">
                        <property name="target"
                                  value="com.amee.platform.resource.dataitem.DataItemsResource$FormAcceptor"/>
                    </bean>
                </entry>
            </map>
        </property>
    </bean>

    <bean id="dataItemResource" class="com.amee.restlet.resource.GenericResource" scope="prototype">
        <property name="modifiable" value="true"/>
        <property name="allowPost" value="false"/>
        <property name="attributeNames">
            <set>
                <value>activeUserUid</value>
                <value>categoryIdentifier</value>
                <value>itemIdentifier</value>
            </set>
        </property>
        <property name="builder">
            <bean class="com.amee.base.resource.LocalResourceBuilder">
                <property name="target"
                          value="com.amee.platform.resource.dataitem.DataItemResource$Builder"/>
            </bean>
        </property>
        <property name="acceptors">
            <map>
                <entry key="application/x-www-form-urlencoded">
                    <bean class="com.amee.base.resource.LocalResourceAcceptor">
                        <property name="target"
                                  value="com.amee.platform.resource.dataitem.DataItemResource$FormAcceptor"/>
                    </bean>
                </entry>
            </map>
        </property>
        <property name="remover">
            <bean class="com.amee.base.resource.LocalResourceRemover">
                <property name="target"
                          value="com.amee.platform.resource.dataitem.DataItemResource$Remover"/>
            </bean>
        </property>
    </bean>

    <bean id="dataItemCalculationResource" class="com.amee.restlet.resource.GenericResource" scope="prototype">
        <property name="modifiable" value="true"/>
        <property name="allowPost" value="false"/>
        <property name="lastSegment" value="calculation"/>
        <property name="attributeNames">
            <set>
                <value>activeUserUid</value>
                <value>categoryIdentifier</value>
                <value>itemIdentifier</value>
            </set>
        </property>
        <property name="builder">
            <bean class="com.amee.base.resource.LocalResourceBuilder">
                <property name="target"
                          value="com.amee.platform.resource.dataitem.DataItemCalculationResource$Builder"/>
            </bean>
        </property>
    </bean>

    <bean id="dataItemValuesResource" class="com.amee.restlet.resource.GenericResource" scope="prototype">
        <property name="modifiable" value="true"/>
        <property name="allowDelete" value="false"/>
        <property name="allowPost" value="true"/>
        <property name="allowPut" value="false"/>
        <property name="lastSegment" value="values"/>
        <property name="attributeNames">
            <set>
                <value>activeUserUid</value>
                <value>categoryIdentifier</value>
                <value>itemIdentifier</value>
            </set>
        </property>
        <property name="builder">
            <bean class="com.amee.base.resource.LocalResourceBuilder">
                <property name="target"
                          value="com.amee.platform.resource.dataitemvalue.DataItemValuesResource$Builder"/>
            </bean>
        </property>
    </bean>

    <bean id="dataItemValueHistoryResource" class="com.amee.restlet.resource.GenericResource" scope="prototype">
        <property name="modifiable" value="true"/>
        <property name="allowDelete" value="false"/>
        <property name="allowPost" value="true"/>
        <property name="allowPut" value="false"/>
        <property name="attributeNames">
            <set>
                <value>activeUserUid</value>
                <value>categoryIdentifier</value>
                <value>itemIdentifier</value>
                <value>valuePath</value>
            </set>
        </property>
        <property name="builder">
            <bean class="com.amee.base.resource.LocalResourceBuilder">
                <property name="target"
                          value="com.amee.platform.resource.dataitemvalue.DataItemValueHistoryResource$Builder"/>
            </bean>
        </property>
        <property name="acceptors">
            <map>
                <entry key="application/x-www-form-urlencoded">
                    <bean class="com.amee.base.resource.LocalResourceAcceptor">
                        <property name="target"
                                  value="com.amee.platform.resource.dataitemvalue.DataItemValueHistoryResource$FormAcceptor"/>
                    </bean>
                </entry>
            </map>
        </property>
    </bean>

    <bean id="dataItemValueResource" class="com.amee.restlet.resource.GenericResource" scope="prototype">
        <property name="modifiable" value="true"/>
        <property name="allowDelete" value="true"/>
        <property name="allowPost" value="false"/>
        <property name="allowPut" value="true"/>
        <property name="attributeNames">
            <set>
                <value>activeUserUid</value>
                <value>categoryIdentifier</value>
                <value>itemIdentifier</value>
                <value>valuePath</value>
                <value>itemValueIdentifier</value>
            </set>
        </property>
        <property name="builder">
            <bean class="com.amee.base.resource.LocalResourceBuilder">
                <property name="target"
                          value="com.amee.platform.resource.dataitemvalue.DataItemValueResource$Builder"/>
            </bean>
        </property>
        <property name="acceptors">
            <map>
                <entry key="application/x-www-form-urlencoded">
                    <bean class="com.amee.base.resource.LocalResourceAcceptor">
                        <property name="target"
                                  value="com.amee.platform.resource.dataitemvalue.DataItemValueResource$FormAcceptor"/>
                    </bean>
                </entry>
            </map>
        </property>
        <property name="remover">
            <bean class="com.amee.base.resource.LocalResourceRemover">
                <property name="target"
                          value="com.amee.platform.resource.dataitemvalue.DataItemValueResource$Remover"/>
            </bean>
        </property>
    </bean>

    <!-- Definitions -->
    <bean id="definitionsRouter" class="com.amee.restlet.version.VersionSpringRouter">
        <constructor-arg ref="platformApplication"/>
        <property name="defaultMatchingMode" ref="modeStartsWith"/>
        <property name="defaultMatchQuery" value="false"/>
        <property name="attachments">
            <map>
                <entry key="">
                    <bean class="com.amee.restlet.version.VersionFinder">
                        <lookup-method name="createResource" bean="itemDefinitionsResource"/>
                        <property name="since" value="3.3.0"/>
                    </bean>
                </entry>
                <entry key="/{itemDefinitionIdentifier}">
                    <bean class="com.amee.restlet.version.VersionFinder">
                        <lookup-method name="createResource" bean="itemDefinitionResource"/>
                        <property name="since" value="3.1.0"/>
                    </bean>
                </entry>
                <entry key="/{itemDefinitionIdentifier}/values">
                    <bean class="com.amee.restlet.version.VersionFinder">
                        <lookup-method name="createResource" bean="itemValueDefinitionsResource"/>
                        <property name="since" value="3.1.0"/>
                    </bean>
                </entry>
                <entry key="/{itemDefinitionIdentifier}/values/{itemValueDefinitionIdentifier}">
                    <bean class="com.amee.restlet.version.VersionFinder">
                        <lookup-method name="createResource" bean="itemValueDefinitionResource"/>
                        <property name="since" value="3.0.0"/>
                    </bean>
                </entry>
                <entry key="/{itemDefinitionIdentifier}/returnvalues">
                    <bean class="com.amee.restlet.version.VersionFinder">
                        <lookup-method name="createResource" bean="returnValueDefinitionsResource"/>
                        <property name="since" value="3.1.0"/>
                    </bean>
                </entry>
                <entry key="/{itemDefinitionIdentifier}/returnvalues/{returnValueDefinitionIdentifier}">
                    <bean class="com.amee.restlet.version.VersionFinder">
                        <lookup-method name="createResource" bean="returnValueDefinitionResource"/>
                        <property name="since" value="3.1.0"/>
                    </bean>
                </entry>
                <entry key="/{itemDefinitionIdentifier}/algorithms">
                    <bean class="com.amee.restlet.version.VersionFinder">
                        <lookup-method name="createResource" bean="algorithmsResource"/>
                        <property name="since" value="3.1.0"/>
                    </bean>
                </entry>
                <entry key="/{itemDefinitionIdentifier}/algorithms/{algorithmIdentifier}">
                    <bean class="com.amee.restlet.version.VersionFinder">
                        <lookup-method name="createResource" bean="algorithmResource"/>
                        <property name="since" value="3.0.0"/>
                    </bean>
                </entry>
            </map>
        </property>
    </bean>

    <bean id="itemDefinitionsResource" class="com.amee.restlet.resource.GenericResource" scope="prototype">
        <property name="modifiable" value="true"/>
        <property name="allowPost" value="true"/>
        <property name="attributeNames">
            <set>
                <value>activeUserUid</value>
            </set>
        </property>
        <property name="builder">
            <bean class="com.amee.base.resource.LocalResourceBuilder">
                <property name="target"
                          value="com.amee.platform.resource.itemdefinition.ItemDefinitionsResource$Builder"/>
            </bean>
        </property>
        <property name="acceptors">
            <map>
                <entry key="application/x-www-form-urlencoded">
                    <bean class="com.amee.base.resource.LocalResourceAcceptor">
                        <property name="target"
                                  value="com.amee.platform.resource.itemdefinition.ItemDefinitionsResource$FormAcceptor"/>
                    </bean>
                </entry>
            </map>
        </property>
    </bean>

    <bean id="itemDefinitionResource" class="com.amee.restlet.resource.GenericResource" scope="prototype">
        <property name="modifiable" value="true"/>
        <property name="allowPost" value="false"/>
        <property name="attributeNames">
            <set>
                <value>activeUserUid</value>
                <value>itemDefinitionIdentifier</value>
            </set>
        </property>
        <property name="builder">
            <bean class="com.amee.base.resource.LocalResourceBuilder">
                <property name="target"
                          value="com.amee.platform.resource.itemdefinition.ItemDefinitionResource$Builder"/>
            </bean>
        </property>
        <property name="acceptors">
            <map>
                <entry key="application/x-www-form-urlencoded">
                    <bean class="com.amee.base.resource.LocalResourceAcceptor">
                        <property name="target"
                                  value="com.amee.platform.resource.itemdefinition.ItemDefinitionResource$FormAcceptor"/>
                    </bean>
                </entry>
            </map>
        </property>
        <property name="remover">
            <bean class="com.amee.base.resource.LocalResourceRemover">
                <property name="target"
                          value="com.amee.platform.resource.itemdefinition.ItemDefinitionResource$Remover"/>
            </bean>
        </property>
    </bean>

    <bean id="itemValueDefinitionsResource" class="com.amee.restlet.resource.GenericResource" scope="prototype">
        <property name="modifiable" value="true"/>
        <property name="allowPost" value="true"/>
        <property name="attributeNames">
            <set>
                <value>activeUserUid</value>
                <value>itemDefinitionIdentifier</value>
            </set>
        </property>
        <property name="builder">
            <bean class="com.amee.base.resource.LocalResourceBuilder">
                <property name="target"
                          value="com.amee.platform.resource.itemvaluedefinition.ItemValueDefinitionsResource$Builder"/>
            </bean>
        </property>
        <property name="acceptors">
            <map>
                <entry key="application/x-www-form-urlencoded">
                    <bean class="com.amee.base.resource.LocalResourceAcceptor">
                        <property name="target"
                                  value="com.amee.platform.resource.itemvaluedefinition.ItemValueDefinitionsResource$FormAcceptor"/>
                    </bean>
                </entry>
                <entry key="application/xml">
                    <bean class="com.amee.base.resource.LocalResourceAcceptor">
                        <property name="target"
                                  value="com.amee.platform.resource.itemvaluedefinition.ItemValueDefinitionsResource$DOMAcceptor"/>
                    </bean>
                </entry>
            </map>
        </property>
    </bean>

    <bean id="itemValueDefinitionResource" class="com.amee.restlet.resource.GenericResource" scope="prototype">
        <property name="modifiable" value="true"/>
        <property name="allowPost" value="false"/>
        <property name="attributeNames">
            <set>
                <value>activeUserUid</value>
                <value>itemDefinitionIdentifier</value>
                <value>itemValueDefinitionIdentifier</value>
            </set>
        </property>
        <property name="builder">
            <bean class="com.amee.base.resource.LocalResourceBuilder">
                <property name="target"
                          value="com.amee.platform.resource.itemvaluedefinition.ItemValueDefinitionResource$Builder"/>
            </bean>
        </property>
        <property name="acceptors">
            <map>
                <entry key="application/x-www-form-urlencoded">
                    <bean class="com.amee.base.resource.LocalResourceAcceptor">
                        <property name="target"
                                  value="com.amee.platform.resource.itemvaluedefinition.ItemValueDefinitionResource$FormAcceptor"/>
                    </bean>
                </entry>
                <entry key="application/xml">
                    <bean class="com.amee.base.resource.LocalResourceAcceptor">
                        <property name="target"
                                  value="com.amee.platform.resource.itemvaluedefinition.ItemValueDefinitionResource$DOMAcceptor"/>
                    </bean>
                </entry>
            </map>
        </property>
        <property name="remover">
            <bean class="com.amee.base.resource.LocalResourceRemover">
                <property name="target"
                          value="com.amee.platform.resource.itemvaluedefinition.ItemValueDefinitionResource$Remover"/>
            </bean>
        </property>
    </bean>

    <bean id="returnValueDefinitionsResource" class="com.amee.restlet.resource.GenericResource" scope="prototype">
        <property name="modifiable" value="true"/>
        <property name="allowPost" value="true"/>
        <property name="attributeNames">
            <set>
                <value>activeUserUid</value>
                <value>itemDefinitionIdentifier</value>
            </set>
        </property>
        <property name="builder">
            <bean class="com.amee.base.resource.LocalResourceBuilder">
                <property name="target"
                          value="com.amee.platform.resource.returnvaluedefinition.ReturnValueDefinitionsResource$Builder"/>
            </bean>
        </property>
        <property name="acceptors">
            <map>
                <entry key="application/x-www-form-urlencoded">
                    <bean class="com.amee.base.resource.LocalResourceAcceptor">
                        <property name="target"
                                  value="com.amee.platform.resource.returnvaluedefinition.ReturnValueDefinitionsResource$FormAcceptor"/>
                    </bean>
                </entry>
            </map>
        </property>
    </bean>

    <bean id="returnValueDefinitionResource" class="com.amee.restlet.resource.GenericResource" scope="prototype">
        <property name="modifiable" value="true"/>
        <property name="allowPost" value="false"/>
        <property name="attributeNames">
            <set>
                <value>activeUserUid</value>
                <value>itemDefinitionIdentifier</value>
                <value>returnValueDefinitionIdentifier</value>
            </set>
        </property>
        <property name="builder">
            <bean class="com.amee.base.resource.LocalResourceBuilder">
                <property name="target"
                          value="com.amee.platform.resource.returnvaluedefinition.ReturnValueDefinitionResource$Builder"/>
            </bean>
        </property>
        <property name="acceptors">
            <map>
                <entry key="application/x-www-form-urlencoded">
                    <bean class="com.amee.base.resource.LocalResourceAcceptor">
                        <property name="target"
                                  value="com.amee.platform.resource.returnvaluedefinition.ReturnValueDefinitionResource$FormAcceptor"/>
                    </bean>
                </entry>
            </map>
        </property>
        <property name="remover">
            <bean class="com.amee.base.resource.LocalResourceRemover">
                <property name="target"
                          value="com.amee.platform.resource.returnvaluedefinition.ReturnValueDefinitionResource$Remover"/>
            </bean>
        </property>
    </bean>

    <bean id="algorithmsResource" class="com.amee.restlet.resource.GenericResource" scope="prototype">
        <property name="modifiable" value="true"/>
        <property name="allowPost" value="true"/>
        <property name="attributeNames">
            <set>
                <value>activeUserUid</value>
                <value>itemDefinitionIdentifier</value>
            </set>
        </property>
        <property name="builder">
            <bean class="com.amee.base.resource.LocalResourceBuilder">
                <property name="target"
                          value="com.amee.platform.resource.algorithm.AlgorithmsResource$Builder"/>
            </bean>
        </property>
        <property name="acceptors">
            <map>
                <entry key="application/x-www-form-urlencoded">
                    <bean class="com.amee.base.resource.LocalResourceAcceptor">
                        <property name="target"
                                  value="com.amee.platform.resource.algorithm.AlgorithmsResource$FormAcceptor"/>
                    </bean>
                </entry>
            </map>
        </property>
    </bean>

    <bean id="algorithmResource" class="com.amee.restlet.resource.GenericResource" scope="prototype">
        <property name="modifiable" value="true"/>
        <property name="allowPost" value="false"/>
        <property name="attributeNames">
            <set>
                <value>activeUserUid</value>
                <value>itemDefinitionIdentifier</value>
                <value>algorithmIdentifier</value>
            </set>
        </property>
        <property name="builder">
            <bean class="com.amee.base.resource.LocalResourceBuilder">
                <property name="target"
                          value="com.amee.platform.resource.algorithm.AlgorithmResource$Builder"/>
            </bean>
        </property>
        <property name="acceptors">
            <map>
                <entry key="application/x-www-form-urlencoded">
                    <bean class="com.amee.base.resource.LocalResourceAcceptor">
                        <property name="target"
                                  value="com.amee.platform.resource.algorithm.AlgorithmResource$FormAcceptor"/>
                    </bean>
                </entry>
            </map>
        </property>
        <property name="remover">
            <bean class="com.amee.base.resource.LocalResourceRemover">
                <property name="target"
                          value="com.amee.platform.resource.algorithm.AlgorithmResource$Remover"/>
            </bean>
        </property>
    </bean>

    <!-- Profiles -->
    <bean id="profilesRouter" class="com.amee.restlet.version.VersionSpringRouter">
        <constructor-arg ref="platformApplication"/>
        <property name="defaultMatchingMode" ref="modeStartsWith"/>
        <property name="defaultMatchQuery" value="false"/>
        <property name="attachments">
            <map>
                <entry key="">
                    <bean class="com.amee.restlet.version.VersionFinder">
                        <lookup-method name="createResource" bean="profilesResource"/>
                        <property name="since" value="3.6.0"/>
                    </bean>
                </entry>
                <entry key="/{profileIdentifier}">
                    <bean class="com.amee.restlet.version.VersionFinder">
                        <lookup-method name="createResource" bean="profileResource"/>
                        <property name="since" value="3.6.0"/>
                    </bean>
                </entry>
                <entry key="/{profileIdentifier}/items">
                    <bean class="com.amee.restlet.version.VersionFinder">
                        <lookup-method name="createResource" bean="profileItemsResource"/>
                        <property name="since" value="3.6.0"/>
                    </bean>
                </entry>
                <entry key="/{profileIdentifier}/items/{itemIdentifier}">
                    <bean class="com.amee.restlet.version.VersionFinder">
                        <lookup-method name="createResource" bean="profileItemResource"/>
                        <property name="since" value="3.6.0"/>
                    </bean>
                </entry>
                <entry key="/{profileIdentifier}/items/{itemIdentifier}/values">
                    <bean class="com.amee.restlet.version.VersionFinder">
                        <lookup-method name="createResource" bean="profileItemValuesResource"/>
                        <property name="since" value="3.6.0"/>
                    </bean>
                </entry>
            </map>
        </property>
    </bean>

    <bean id="profilesResource" class="com.amee.restlet.resource.GenericResource" scope="prototype">
        <property name="modifiable" value="true"/>
        <property name="allowDelete" value="false"/>
        <property name="allowPost" value="true"/>
        <property name="allowPut" value="false"/>
        <property name="lastSegment" value="profiles"/>
        <property name="attributeNames">
            <set>
                <value>activeUserUid</value>
            </set>
        </property>
        <property name="builder">
            <bean class="com.amee.base.resource.LocalResourceBuilder">
                <property name="target"
                          value="com.amee.platform.resource.profile.ProfilesResource$Builder"/>
            </bean>
        </property>
        <property name="acceptors">
            <map>
                <entry key="application/x-www-form-urlencoded">
                    <bean class="com.amee.base.resource.LocalResourceAcceptor">
                        <property name="target"
                                  value="com.amee.platform.resource.profile.ProfilesResource$FormAcceptor"/>
                    </bean>
                </entry>
            </map>
        </property>
    </bean>

    <bean id="profileResource" class="com.amee.restlet.resource.GenericResource" scope="prototype">
        <property name="modifiable" value="true"/>
        <property name="allowDelete" value="true"/>
        <property name="allowPut" value="false"/>
        <property name="allowPost" value="false"/>
        <property name="attributeNames">
            <set>
                <value>activeUserUid</value>
                <value>profileIdentifier</value>
            </set>
        </property>
        <property name="builder">
            <bean class="com.amee.base.resource.LocalResourceBuilder">
                <property name="target"
                          value="com.amee.platform.resource.profile.ProfileResource$Builder"/>
            </bean>
        </property>
        <property name="remover">
            <bean class="com.amee.base.resource.LocalResourceRemover">
                <property name="target"
                          value="com.amee.platform.resource.profile.ProfileResource$Remover"/>
            </bean>
        </property>
    </bean>

    <bean id="profileItemsResource" class="com.amee.restlet.resource.GenericResource" scope="prototype">
        <property name="modifiable" value="true"/>
        <property name="allowDelete" value="false"/>
        <property name="allowPost" value="true"/>
        <property name="allowPut" value="true"/>
        <property name="lastSegment" value="items"/>
        <property name="attributeNames">
            <set>
                <value>activeUserUid</value>
                <value>profileIdentifier</value>
            </set>
        </property>
        <property name="builder">
            <bean class="com.amee.base.resource.LocalResourceBuilder">
                <property name="target"
                          value="com.amee.platform.resource.profileitem.ProfileItemsResource$Builder"/>
            </bean>
        </property>
        <property name="acceptors">
            <map>
                <entry key="application/x-www-form-urlencoded">
                    <bean class="com.amee.base.resource.LocalResourceAcceptor">
                        <property name="target"
                                  value="com.amee.platform.resource.profileitem.ProfileItemsResource$FormAcceptor"/>
                    </bean>
                </entry>
                <entry key="application/json">
                    <bean class="com.amee.base.resource.LocalResourceAcceptor">
                        <property name="target" 
                                  value="com.amee.platform.resource.profileitem.ProfileItemsResource$JSONAcceptor" />
                    </bean>
                </entry>
                <entry key="application/xml">
                    <bean class="com.amee.base.resource.LocalResourceAcceptor">
                        <property name="target" 
                                  value="com.amee.platform.resource.profileitem.ProfileItemsResource$DOMAcceptor" />
                    </bean>
                </entry>
            </map>
        </property>
    </bean>

    <bean id="profileItemResource" class="com.amee.restlet.resource.GenericResource" scope="prototype">
        <property name="modifiable" value="true"/>
        <property name="allowPost" value="false"/>
        <property name="attributeNames">
            <set>
                <value>activeUserUid</value>
                <value>profileIdentifier</value>
                <value>itemIdentifier</value>
            </set>
        </property>
        <property name="builder">
            <bean class="com.amee.base.resource.LocalResourceBuilder">
                <property name="target"
                          value="com.amee.platform.resource.profileitem.ProfileItemResource$Builder"/>
            </bean>
        </property>
        <property name="acceptors">
            <map>
                <entry key="application/x-www-form-urlencoded">
                    <bean class="com.amee.base.resource.LocalResourceAcceptor">
                        <property name="target"
                                  value="com.amee.platform.resource.profileitem.ProfileItemResource$FormAcceptor"/>
                    </bean>
                </entry>
            </map>
        </property>
        <property name="remover">
            <bean class="com.amee.base.resource.LocalResourceRemover">
                <property name="target"
                          value="com.amee.platform.resource.profileitem.ProfileItemResource$Remover"/>
            </bean>
        </property>
    </bean>

    <bean id="profileItemValuesResource" class="com.amee.restlet.resource.GenericResource" scope="prototype">
        <property name="modifiable" value="false"/>
        <property name="attributeNames">
            <set>
                <value>activeUserUid</value>
                <value>profileIdentifier</value>
                <value>itemIdentifier</value>
            </set>
        </property>
        <property name="builder">
            <bean class="com.amee.base.resource.LocalResourceBuilder">
                <property name="target"
                          value="com.amee.platform.resource.profileitemvalue.ProfileItemValuesResource$Builder"/>
            </bean>
        </property>
    </bean>

    <!-- Search. -->
    <bean id="searchRouter" class="com.amee.restlet.version.VersionSpringRouter">
        <constructor-arg ref="platformApplication"/>
        <property name="defaultMatchingMode" ref="modeStartsWith"/>
        <property name="defaultMatchQuery" value="false"/>
        <property name="attachments">
            <map>
                <entry key="">
                    <bean class="com.amee.restlet.version.VersionFinder">
                        <lookup-method name="createResource" bean="searchResource"/>
                        <property name="since" value="3.0.0"/>
                    </bean>
                </entry>
            </map>
        </property>
    </bean>

    <bean id="searchResource" class="com.amee.restlet.resource.GenericResource" scope="prototype">
        <property name="modifiable" value="false"/>
        <property name="allowDelete" value="false"/>
        <property name="allowPut" value="false"/>
        <property name="lastSegment" value="search"/>
        <property name="attributeNames">
            <set>
                <value>activeUserUid</value>
            </set>
        </property>
        <property name="builder">
            <bean class="com.amee.base.resource.LocalResourceBuilder">
                <property name="target"
                          value="com.amee.platform.resource.search.SearchResource$Builder"/>
            </bean>
        </property>
    </bean>

    <!-- Tags. -->
    <bean id="tagsRouter" class="com.amee.restlet.version.VersionSpringRouter">
        <constructor-arg ref="platformApplication"/>
        <property name="defaultMatchingMode" ref="modeStartsWith"/>
        <property name="defaultMatchQuery" value="false"/>
        <property name="attachments">
            <map>
                <entry key="">
                    <bean class="com.amee.restlet.version.VersionFinder">
                        <lookup-method name="createResource" bean="tagsResource"/>
                        <property name="since" value="3.0.0"/>
                    </bean>
                </entry>
                <entry key="/{tagIdentifier}">
                    <bean class="com.amee.restlet.version.VersionFinder">
                        <lookup-method name="createResource" bean="tagResource"/>
                        <property name="since" value="3.2.0"/>
                    </bean>
                </entry>
            </map>
        </property>
    </bean>

    <bean id="tagsResource" class="com.amee.restlet.resource.GenericResource" scope="prototype">
        <property name="modifiable" value="false"/>
        <property name="allowDelete" value="false"/>
        <property name="allowPut" value="false"/>
        <property name="allowPost" value="true"/>
        <property name="lastSegment" value="tags"/>
        <property name="attributeNames">
            <set>
                <value>activeUserUid</value>
                <value>categoryIdentifier</value>
            </set>
        </property>
        <property name="builder">
            <bean class="com.amee.base.resource.LocalResourceBuilder">
                <property name="target"
                          value="com.amee.platform.resource.tag.TagsResource$Builder"/>
            </bean>
        </property>
        <property name="acceptors">
            <map>
                <entry key="application/x-www-form-urlencoded">
                    <bean class="com.amee.base.resource.LocalResourceAcceptor">
                        <property name="target"
                                  value="com.amee.platform.resource.tag.TagsResource$FormAcceptor"/>
                    </bean>
                </entry>
            </map>
        </property>
    </bean>

    <bean id="tagResource" class="com.amee.restlet.resource.GenericResource" scope="prototype">
        <property name="modifiable" value="false"/>
        <property name="allowDelete" value="true"/>
        <property name="allowPut" value="true"/>
        <property name="allowPost" value="false"/>
        <property name="attributeNames">
            <set>
                <value>activeUserUid</value>
                <value>tagIdentifier</value>
                <value>categoryIdentifier</value>
            </set>
        </property>
        <property name="builder">
            <bean class="com.amee.base.resource.LocalResourceBuilder">
                <property name="target"
                          value="com.amee.platform.resource.tag.TagResource$Builder"/>
            </bean>
        </property>
        <property name="acceptors">
            <map>
                <entry key="application/x-www-form-urlencoded">
                    <bean class="com.amee.base.resource.LocalResourceAcceptor">
                        <property name="target"
                                  value="com.amee.platform.resource.tag.TagResource$FormAcceptor"/>
                    </bean>
                </entry>
            </map>
        </property>
        <property name="remover">
            <bean class="com.amee.base.resource.LocalResourceRemover">
                <property name="target"
                          value="com.amee.platform.resource.tag.TagResource$Remover"/>
            </bean>
        </property>
    </bean>

    <!-- Units. -->
    <bean id="unitsRouter" class="com.amee.restlet.version.VersionSpringRouter">
        <constructor-arg ref="platformApplication"/>
        <property name="defaultMatchingMode" ref="modeStartsWith"/>
        <property name="defaultMatchQuery" value="false"/>
        <property name="attachments">
            <map>
                <entry key="">
                    <bean class="com.amee.restlet.version.VersionFinder">
                        <lookup-method name="createResource" bean="unitsResource"/>
                        <property name="since" value="3.5.0"/>
                    </bean>
                </entry>
                <entry key="/types">
                    <bean class="com.amee.restlet.version.VersionFinder">
                        <lookup-method name="createResource" bean="unitTypesResource"/>
                        <property name="since" value="3.5.0"/>
                    </bean>
                </entry>
                <entry key="/types/{unitTypeIdentifier}">
                    <bean class="com.amee.restlet.version.VersionFinder">
                        <lookup-method name="createResource" bean="unitTypeResource"/>
                        <property name="since" value="3.5.0"/>
                    </bean>
                </entry>
                <entry key="/types/{unitTypeIdentifier}/units">
                    <bean class="com.amee.restlet.version.VersionFinder">
                        <lookup-method name="createResource" bean="unitTypeUnitsResource"/>
                        <property name="since" value="3.5.0"/>
                    </bean>
                </entry>
                <entry key="/types/{unitTypeIdentifier}/units/{unitIdentifier}">
                    <bean class="com.amee.restlet.version.VersionFinder">
                        <lookup-method name="createResource" bean="unitTypeUnitResource"/>
                        <property name="since" value="3.5.0"/>
                    </bean>
                </entry>
            </map>
        </property>
    </bean>

    <bean id="unitsResource" class="com.amee.restlet.resource.GenericResource" scope="prototype">
        <property name="modifiable" value="false"/>
        <property name="allowDelete" value="false"/>
        <property name="allowPut" value="false"/>
        <property name="allowPost" value="true"/>
        <property name="lastSegment" value="units"/>
        <property name="attributeNames">
            <set>
                <value>activeUserUid</value>
            </set>
        </property>
        <property name="builder">
            <bean class="com.amee.base.resource.LocalResourceBuilder">
                <property name="target"
                          value="com.amee.platform.resource.unit.UnitsResource$Builder"/>
            </bean>
        </property>
        <property name="acceptors">
            <map>
                <entry key="application/x-www-form-urlencoded">
                    <bean class="com.amee.base.resource.LocalResourceAcceptor">
                        <property name="target"
                                  value="com.amee.platform.resource.unit.UnitsResource$FormAcceptor"/>
                    </bean>
                </entry>
            </map>
        </property>
    </bean>

    <bean id="unitTypesResource" class="com.amee.restlet.resource.GenericResource" scope="prototype">
        <property name="modifiable" value="false"/>
        <property name="allowDelete" value="false"/>
        <property name="allowPut" value="false"/>
        <property name="allowPost" value="true"/>
        <property name="lastSegment" value="types"/>
        <property name="attributeNames">
            <set>
                <value>activeUserUid</value>
            </set>
        </property>
        <property name="builder">
            <bean class="com.amee.base.resource.LocalResourceBuilder">
                <property name="target"
                          value="com.amee.platform.resource.unittype.UnitTypesResource$Builder"/>
            </bean>
        </property>
        <property name="acceptors">
            <map>
                <entry key="application/x-www-form-urlencoded">
                    <bean class="com.amee.base.resource.LocalResourceAcceptor">
                        <property name="target"
                                  value="com.amee.platform.resource.unittype.UnitTypesResource$FormAcceptor"/>
                    </bean>
                </entry>
            </map>
        </property>
    </bean>

    <bean id="unitTypeResource" class="com.amee.restlet.resource.GenericResource" scope="prototype">
        <property name="modifiable" value="false"/>
        <property name="allowDelete" value="true"/>
        <property name="allowPut" value="true"/>
        <property name="allowPost" value="false"/>
        <property name="attributeNames">
            <set>
                <value>activeUserUid</value>
                <value>unitTypeIdentifier</value>
            </set>
        </property>
        <property name="builder">
            <bean class="com.amee.base.resource.LocalResourceBuilder">
                <property name="target"
                          value="com.amee.platform.resource.unittype.UnitTypeResource$Builder"/>
            </bean>
        </property>
        <property name="acceptors">
            <map>
                <entry key="application/x-www-form-urlencoded">
                    <bean class="com.amee.base.resource.LocalResourceAcceptor">
                        <property name="target"
                                  value="com.amee.platform.resource.unittype.UnitTypeResource$FormAcceptor"/>
                    </bean>
                </entry>
            </map>
        </property>
        <property name="remover">
            <bean class="com.amee.base.resource.LocalResourceRemover">
                <property name="target"
                          value="com.amee.platform.resource.unittype.UnitTypeResource$Remover"/>
            </bean>
        </property>
    </bean>

    <bean id="unitTypeUnitsResource" class="com.amee.restlet.resource.GenericResource" scope="prototype">
        <property name="modifiable" value="false"/>
        <property name="allowDelete" value="false"/>
        <property name="allowPut" value="false"/>
        <property name="allowPost" value="true"/>
        <property name="lastSegment" value="units"/>
        <property name="attributeNames">
            <set>
                <value>activeUserUid</value>
                <value>unitTypeIdentifier</value>
            </set>
        </property>
        <property name="builder">
            <bean class="com.amee.base.resource.LocalResourceBuilder">
                <property name="target"
                          value="com.amee.platform.resource.unit.UnitsResource$Builder"/>
            </bean>
        </property>
        <property name="acceptors">
            <map>
                <entry key="application/x-www-form-urlencoded">
                    <bean class="com.amee.base.resource.LocalResourceAcceptor">
                        <property name="target"
                                  value="com.amee.platform.resource.unit.UnitsResource$FormAcceptor"/>
                    </bean>
                </entry>
            </map>
        </property>
    </bean>

    <bean id="unitTypeUnitResource" class="com.amee.restlet.resource.GenericResource" scope="prototype">
        <property name="modifiable" value="false"/>
        <property name="allowDelete" value="true"/>
        <property name="allowPut" value="true"/>
        <property name="allowPost" value="false"/>
        <property name="attributeNames">
            <set>
                <value>activeUserUid</value>
                <value>unitTypeIdentifier</value>
                <value>unitIdentifier</value>
            </set>
        </property>
        <property name="builder">
            <bean class="com.amee.base.resource.LocalResourceBuilder">
                <property name="target"
                          value="com.amee.platform.resource.unit.UnitResource$Builder"/>
            </bean>
        </property>
        <property name="acceptors">
            <map>
                <entry key="application/x-www-form-urlencoded">
                    <bean class="com.amee.base.resource.LocalResourceAcceptor">
                        <property name="target"
                                  value="com.amee.platform.resource.unit.UnitResource$FormAcceptor"/>
                    </bean>
                </entry>
            </map>
        </property>
        <property name="remover">
            <bean class="com.amee.base.resource.LocalResourceRemover">
                <property name="target"
                          value="com.amee.platform.resource.unit.UnitResource$Remover"/>
            </bean>
        </property>
    </bean>

    <!-- Drill -->
    <bean id="drillResource" class="com.amee.restlet.resource.GenericResource" scope="prototype">
        <property name="modifiable" value="false"/>
        <property name="attributeNames">
            <set>
                <value>activeUserUid</value>
                <value>categoryIdentifier</value>
            </set>
        </property>
        <property name="builder">
            <bean class="com.amee.base.resource.LocalResourceBuilder">
                <property name="target"
                          value="com.amee.platform.resource.drill.DrillResource$Builder"/>
            </bean>
        </property>
    </bean>

</beans>