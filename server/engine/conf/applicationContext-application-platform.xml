<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="http://www.springframework.org/schema/beans
                           http://www.springframework.org/schema/beans/spring-beans-3.0.xsd">

    <bean id="platformApplication" class="org.restlet.Application">
        <property name="root" ref="platformRoot"/>
        <property name="tunnelService.methodTunnel" value="true"/>
        <property name="tunnelService.extensionsTunnel" value="true"/>
        <property name="statusService" ref="ameeStatusService"/>
        <property name="name" value="Platform Application"/>
    </bean>

    <bean id="platformRoot" class="org.restlet.ext.spring.SpringRouter">
        <constructor-arg ref="platformApplication"/>
        <property name="attachments">
            <map>
                <entry key="">
                    <bean class="com.amee.restlet.transaction.TransactionControllerFilter">
                        <property name="next">
                            <bean class="com.amee.restlet.SiteFilter">
                                <property name="next">
                                    <bean class="com.amee.platform.restlet.CollectCredentialsGuard">
                                        <constructor-arg index="0" ref="platformApplication"/>
                                        <constructor-arg index="1" ref="authenticationService"/>
                                        <property name="next" ref="versionsRouter"/>
                                    </bean>
                                </property>
                            </bean>
                        </property>
                    </bean>
                </entry>
            </map>
        </property>
    </bean>

    <bean id="versionsRouter" class="org.restlet.ext.spring.SpringRouter">
        <constructor-arg ref="platformApplication"/>
        <property name="attachments">
            <map>
                <entry key="/{version}">
                    <bean class="com.amee.restlet.version.VersionFilter">
                        <property name="next" ref="platformRouter"/>
                    </bean>
                </entry>
            </map>
        </property>
    </bean>

    <bean id="platformRouter" class="com.amee.restlet.version.VersionSpringRouter">
        <constructor-arg ref="platformApplication"/>
        <property name="attachments">
            <map>
                <entry key="/categories" value-ref="categoriesRouter"/>
                <entry key="/definitions" value-ref="definitionsRouter"/>
                <entry key="/search" value-ref="searchRouter"/>
                <entry key="/tags" value-ref="tagsRouter"/>
            </map>
        </property>
    </bean>

    <bean id="categoriesRouter" class="com.amee.restlet.version.VersionSpringRouter">
        <constructor-arg ref="platformApplication"/>
        <property name="defaultMatchingMode" ref="modeStartsWith"/>
        <property name="defaultMatchQuery" value="false"/>
        <property name="attachments">
            <map>
                <entry key="">
                    <bean class="com.amee.restlet.version.VersionFinder">
                        <lookup-method name="createResource" bean="dataCategoriesResource"/>
                        <property name="since" value="3.0.0"/>
                    </bean>
                </entry>
                <entry key="/{categoryIdentifier}">
                    <bean class="com.amee.restlet.version.VersionFinder">
                        <lookup-method name="createResource" bean="dataCategoryResource"/>
                        <property name="since" value="3.0.0"/>
                    </bean>
                </entry>
                <entry key="/{categoryIdentifier}/items">
                    <bean class="com.amee.restlet.version.VersionFinder">
                        <lookup-method name="createResource" bean="dataItemsResource"/>
                        <property name="since" value="3.0.0"/>
                    </bean>
                </entry>
                <entry key="/{categoryIdentifier}/items/{itemIdentifier}">
                    <bean class="com.amee.restlet.version.VersionFinder">
                        <lookup-method name="createResource" bean="dataItemResource"/>
                        <property name="since" value="3.0.0"/>
                    </bean>
                </entry>
                <entry key="/{categoryIdentifier}/tags" value-ref="tagsRouter"/>
                <entry key="/{categoryIdentifier}/drill">
                    <bean class="com.amee.restlet.version.VersionFinder">
                        <lookup-method name="createResource" bean="drillResource"/>
                        <property name="since" value="3.3.0"/>
                    </bean>
                </entry>
            </map>
        </property>
    </bean>

    <bean id="dataCategoriesResource" class="com.amee.restlet.resource.GenericResource" scope="prototype">
        <property name="modifiable" value="true"/>
        <property name="allowDelete" value="false"/>
        <property name="allowPost" value="true"/>
        <property name="allowPut" value="false"/>
        <property name="lastSegment" value="categories"/>
        <property name="attributeNames">
            <set>
                <value>activeUserUid</value>
            </set>
        </property>
        <property name="builder">
            <bean class="com.amee.base.resource.LocalResourceBuilder">
                <property name="target"
                          value="com.amee.platform.resource.datacategory.DataCategoriesResource$Builder"/>
            </bean>
        </property>
        <property name="acceptors">
            <map>
                <entry key="application/x-www-form-urlencoded">
                    <bean class="com.amee.base.resource.LocalResourceAcceptor">
                        <property name="target"
                                  value="com.amee.platform.resource.datacategory.DataCategoriesResource$FormAcceptor"/>
                    </bean>
                </entry>
            </map>
        </property>
    </bean>

    <bean id="dataCategoryResource" class="com.amee.restlet.resource.GenericResource" scope="prototype">
        <property name="modifiable" value="true"/>
        <property name="allowPost" value="false"/>
        <property name="attributeNames">
            <set>
                <value>activeUserUid</value>
                <value>categoryIdentifier</value>
            </set>
        </property>
        <property name="builder">
            <bean class="com.amee.base.resource.LocalResourceBuilder">
                <property name="target"
                          value="com.amee.platform.resource.datacategory.DataCategoryResource$Builder"/>
            </bean>
        </property>
        <property name="acceptors">
            <map>
                <entry key="application/x-www-form-urlencoded">
                    <bean class="com.amee.base.resource.LocalResourceAcceptor">
                        <property name="target"
                                  value="com.amee.platform.resource.datacategory.DataCategoryResource$FormAcceptor"/>
                    </bean>
                </entry>
            </map>
        </property>
        <property name="remover">
            <bean class="com.amee.base.resource.LocalResourceRemover">
                <property name="target"
                          value="com.amee.platform.resource.datacategory.DataCategoryResource$Remover"/>
            </bean>
        </property>
    </bean>

    <bean id="dataItemsResource" class="com.amee.restlet.resource.GenericResource" scope="prototype">
        <property name="modifiable" value="true"/>
        <property name="allowDelete" value="false"/>
        <property name="allowPut" value="false"/>
        <property name="lastSegment" value="items"/>
        <property name="attributeNames">
            <set>
                <value>activeUserUid</value>
                <value>categoryIdentifier</value>
            </set>
        </property>
        <property name="builder">
            <bean class="com.amee.base.resource.LocalResourceBuilder">
                <property name="target"
                          value="com.amee.platform.resource.dataitem.DataItemsResource$Builder"/>
            </bean>
        </property>
    </bean>

    <bean id="dataItemResource" class="com.amee.restlet.resource.GenericResource" scope="prototype">
        <property name="modifiable" value="true"/>
        <property name="allowPost" value="false"/>
        <property name="attributeNames">
            <set>
                <value>activeUserUid</value>
                <value>categoryIdentifier</value>
                <value>itemIdentifier</value>
            </set>
        </property>
        <property name="builder">
            <bean class="com.amee.base.resource.LocalResourceBuilder">
                <property name="target"
                          value="com.amee.platform.resource.dataitem.DataItemResource$Builder"/>
            </bean>
        </property>
        <property name="acceptors">
            <map>
                <entry key="application/x-www-form-urlencoded">
                    <bean class="com.amee.base.resource.LocalResourceAcceptor">
                        <property name="target"
                                  value="com.amee.platform.resource.dataitem.DataItemResource$FormAcceptor"/>
                    </bean>
                </entry>
            </map>
        </property>
        <!--<property name="remover">-->
        <!--<bean class="com.amee.platform.resource.item.DataItemRemover"/>-->
        <!--</property>-->
    </bean>

    <bean id="definitionsRouter" class="com.amee.restlet.version.VersionSpringRouter">
        <constructor-arg ref="platformApplication"/>
        <property name="defaultMatchingMode" ref="modeStartsWith"/>
        <property name="defaultMatchQuery" value="false"/>
        <property name="attachments">
            <map>
                <entry key="">
                    <bean class="com.amee.restlet.version.VersionFinder">
                        <lookup-method name="createResource" bean="itemDefinitionsResource"/>
                        <property name="since" value="3.3.0"/>
                    </bean>
                </entry>
                <entry key="/{itemDefinitionIdentifier}">
                    <bean class="com.amee.restlet.version.VersionFinder">
                        <lookup-method name="createResource" bean="itemDefinitionResource"/>
                        <property name="since" value="3.1.0"/>
                    </bean>
                </entry>
                <entry key="/{itemDefinitionIdentifier}/values">
                    <bean class="com.amee.restlet.version.VersionFinder">
                        <lookup-method name="createResource" bean="itemValueDefinitionsResource"/>
                        <property name="since" value="3.1.0"/>
                    </bean>
                </entry>
                <entry key="/{itemDefinitionIdentifier}/values/{itemValueDefinitionIdentifier}">
                    <bean class="com.amee.restlet.version.VersionFinder">
                        <lookup-method name="createResource" bean="itemValueDefinitionResource"/>
                        <property name="since" value="3.0.0"/>
                    </bean>
                </entry>
                <entry key="/{itemDefinitionIdentifier}/returnvalues">
                    <bean class="com.amee.restlet.version.VersionFinder">
                        <lookup-method name="createResource" bean="returnValueDefinitionsResource"/>
                        <property name="since" value="3.1.0"/>
                    </bean>
                </entry>
                <entry key="/{itemDefinitionIdentifier}/returnvalues/{returnValueDefinitionIdentifier}">
                    <bean class="com.amee.restlet.version.VersionFinder">
                        <lookup-method name="createResource" bean="returnValueDefinitionResource"/>
                        <property name="since" value="3.1.0"/>
                    </bean>
                </entry>
            </map>
        </property>
    </bean>

    <bean id="itemDefinitionsResource" class="com.amee.restlet.resource.GenericResource" scope="prototype">
        <property name="modifiable" value="true"/>
        <property name="allowPost" value="false"/>
        <property name="attributeNames">
            <set>
                <value>activeUserUid</value>
            </set>
        </property>
        <property name="builder">
            <bean class="com.amee.base.resource.LocalResourceBuilder">
                <property name="target"
                          value="com.amee.platform.resource.itemdefinition.ItemDefinitionsResource$Builder"/>
            </bean>
        </property>
    </bean>

    <bean id="itemDefinitionResource" class="com.amee.restlet.resource.GenericResource" scope="prototype">
        <property name="modifiable" value="true"/>
        <property name="allowPost" value="false"/>
        <property name="attributeNames">
            <set>
                <value>activeUserUid</value>
                <value>itemDefinitionIdentifier</value>
            </set>
        </property>
        <property name="builder">
            <bean class="com.amee.base.resource.LocalResourceBuilder">
                <property name="target"
                          value="com.amee.platform.resource.itemdefinition.ItemDefinitionResource$Builder"/>
            </bean>
        </property>
        <property name="acceptors">
            <map>
                <entry key="application/x-www-form-urlencoded">
                    <bean class="com.amee.base.resource.LocalResourceAcceptor">
                        <property name="target"
                                  value="com.amee.platform.resource.itemdefinition.ItemDefinitionResource$FormAcceptor"/>
                    </bean>
                </entry>
            </map>
        </property>
        <!--<property name="remover">-->
        <!--<bean class="com.amee.platform.service.v3.definition.ItemDefinitionRemover"/>-->
        <!--</property>-->
    </bean>

    <bean id="itemValueDefinitionsResource" class="com.amee.restlet.resource.GenericResource" scope="prototype">
        <property name="modifiable" value="true"/>
        <property name="allowPost" value="false"/>
        <property name="attributeNames">
            <set>
                <value>activeUserUid</value>
                <value>itemDefinitionIdentifier</value>
            </set>
        </property>
        <property name="builder">
            <bean class="com.amee.base.resource.LocalResourceBuilder">
                <property name="target"
                          value="com.amee.platform.resource.itemvaluedefinition.ItemValueDefinitionsResource$Builder"/>
            </bean>
        </property>
    </bean>

    <bean id="itemValueDefinitionResource" class="com.amee.restlet.resource.GenericResource" scope="prototype">
        <property name="modifiable" value="true"/>
        <property name="allowPost" value="false"/>
        <property name="attributeNames">
            <set>
                <value>activeUserUid</value>
                <value>itemDefinitionIdentifier</value>
                <value>itemValueDefinitionIdentifier</value>
            </set>
        </property>
        <property name="builder">
            <bean class="com.amee.base.resource.LocalResourceBuilder">
                <property name="target"
                          value="com.amee.platform.resource.itemvaluedefinition.ItemValueDefinitionResource$Builder"/>
            </bean>
        </property>
        <property name="acceptors">
            <map>
                <entry key="application/x-www-form-urlencoded">
                    <bean class="com.amee.base.resource.LocalResourceAcceptor">
                        <property name="target"
                                  value="com.amee.platform.resource.itemvaluedefinition.ItemValueDefinitionResource$FormAcceptor"/>
                    </bean>
                </entry>
                <entry key="application/xml">
                    <bean class="com.amee.base.resource.LocalResourceAcceptor">
                        <property name="target"
                                  value="com.amee.platform.resource.itemvaluedefinition.ItemValueDefinitionResource$DOMAcceptor"/>
                    </bean>
                </entry>
            </map>
        </property>
        <!--<property name="remover">-->
        <!--<bean class="com.amee.platform.service.v3.definition.ItemValueDefinitionRemover"/>-->
        <!--</property>-->
    </bean>

    <bean id="returnValueDefinitionsResource" class="com.amee.restlet.resource.GenericResource" scope="prototype">
        <property name="modifiable" value="true"/>
        <property name="allowPost" value="true"/>
        <property name="attributeNames">
            <set>
                <value>activeUserUid</value>
                <value>itemDefinitionIdentifier</value>
            </set>
        </property>
        <property name="builder">
            <bean class="com.amee.base.resource.LocalResourceBuilder">
                <property name="target"
                          value="com.amee.platform.resource.returnvaluedefinition.ReturnValueDefinitionsResource$Builder"/>
            </bean>
        </property>
        <property name="acceptors">
            <map>
                <entry key="application/x-www-form-urlencoded">
                    <bean class="com.amee.base.resource.LocalResourceAcceptor">
                        <property name="target"
                                  value="com.amee.platform.resource.returnvaluedefinition.ReturnValueDefinitionsResource$FormAcceptor"/>
                    </bean>
                </entry>
            </map>
        </property>
    </bean>

    <bean id="returnValueDefinitionResource" class="com.amee.restlet.resource.GenericResource" scope="prototype">
        <property name="modifiable" value="true"/>
        <property name="allowPost" value="false"/>
        <property name="attributeNames">
            <set>
                <value>activeUserUid</value>
                <value>itemDefinitionIdentifier</value>
                <value>returnValueDefinitionIdentifier</value>
            </set>
        </property>
        <property name="builder">
            <bean class="com.amee.base.resource.LocalResourceBuilder">
                <property name="target"
                          value="com.amee.platform.resource.returnvaluedefinition.ReturnValueDefinitionResource$Builder"/>
            </bean>
        </property>
        <property name="acceptors">
            <map>
                <entry key="application/x-www-form-urlencoded">
                    <bean class="com.amee.base.resource.LocalResourceAcceptor">
                        <property name="target"
                                  value="com.amee.platform.resource.returnvaluedefinition.ReturnValueDefinitionResource$FormAcceptor"/>
                    </bean>
                </entry>
            </map>
        </property>
        <property name="remover">
            <bean class="com.amee.base.resource.LocalResourceRemover">
                <property name="target"
                          value="com.amee.platform.resource.returnvaluedefinition.ReturnValueDefinitionResource$Remover"/>
            </bean>
        </property>
    </bean>

    <!-- Search. -->

    <bean id="searchRouter" class="com.amee.restlet.version.VersionSpringRouter">
        <constructor-arg ref="platformApplication"/>
        <property name="defaultMatchingMode" ref="modeStartsWith"/>
        <property name="defaultMatchQuery" value="false"/>
        <property name="attachments">
            <map>
                <entry key="">
                    <bean class="com.amee.restlet.version.VersionFinder">
                        <lookup-method name="createResource" bean="searchResource"/>
                        <property name="since" value="3.0.0"/>
                    </bean>
                </entry>
            </map>
        </property>
    </bean>

    <bean id="searchResource" class="com.amee.restlet.resource.GenericResource" scope="prototype">
        <property name="modifiable" value="false"/>
        <property name="allowDelete" value="false"/>
        <property name="allowPut" value="false"/>
        <property name="lastSegment" value="search"/>
        <property name="attributeNames">
            <set>
                <value>activeUserUid</value>
            </set>
        </property>
        <property name="builder">
            <bean class="com.amee.base.resource.LocalResourceBuilder">
                <property name="target"
                          value="com.amee.platform.resource.search.SearchResource$Builder"/>
            </bean>
        </property>
    </bean>

    <!-- Tags. -->

    <bean id="tagsRouter" class="com.amee.restlet.version.VersionSpringRouter">
        <constructor-arg ref="platformApplication"/>
        <property name="defaultMatchingMode" ref="modeStartsWith"/>
        <property name="defaultMatchQuery" value="false"/>
        <property name="attachments">
            <map>
                <entry key="">
                    <bean class="com.amee.restlet.version.VersionFinder">
                        <lookup-method name="createResource" bean="tagsResource"/>
                        <property name="since" value="3.0.0"/>
                    </bean>
                </entry>
                <entry key="/{tagIdentifier}">
                    <bean class="com.amee.restlet.version.VersionFinder">
                        <lookup-method name="createResource" bean="tagResource"/>
                        <property name="since" value="3.2.0"/>
                    </bean>
                </entry>
            </map>
        </property>
    </bean>

    <bean id="tagsResource" class="com.amee.restlet.resource.GenericResource" scope="prototype">
        <property name="modifiable" value="false"/>
        <property name="allowDelete" value="false"/>
        <property name="allowPut" value="false"/>
        <property name="allowPost" value="true"/>
        <property name="lastSegment" value="tags"/>
        <property name="attributeNames">
            <set>
                <value>activeUserUid</value>
                <value>categoryIdentifier</value>
            </set>
        </property>
        <property name="builder">
            <bean class="com.amee.base.resource.LocalResourceBuilder">
                <property name="target"
                          value="com.amee.platform.resource.tag.TagsResource$Builder"/>
            </bean>
        </property>
        <property name="acceptors">
            <map>
                <entry key="application/x-www-form-urlencoded">
                    <bean class="com.amee.base.resource.LocalResourceAcceptor">
                        <property name="target"
                                  value="com.amee.platform.resource.tag.TagsResource$FormAcceptor"/>
                    </bean>
                </entry>
            </map>
        </property>
    </bean>

    <bean id="tagResource" class="com.amee.restlet.resource.GenericResource" scope="prototype">
        <property name="modifiable" value="false"/>
        <property name="allowDelete" value="true"/>
        <property name="allowPut" value="true"/>
        <property name="allowPost" value="false"/>
        <property name="attributeNames">
            <set>
                <value>activeUserUid</value>
                <value>tagIdentifier</value>
                <value>categoryIdentifier</value>
            </set>
        </property>
        <property name="builder">
            <bean class="com.amee.base.resource.LocalResourceBuilder">
                <property name="target"
                          value="com.amee.platform.resource.tag.TagResource$Builder"/>
            </bean>
        </property>
        <property name="acceptors">
            <map>
                <entry key="application/x-www-form-urlencoded">
                    <bean class="com.amee.base.resource.LocalResourceAcceptor">
                        <property name="target"
                                  value="com.amee.platform.resource.tag.TagResource$FormAcceptor"/>
                    </bean>
                </entry>
            </map>
        </property>
        <property name="remover">
            <bean class="com.amee.base.resource.LocalResourceRemover">
                <property name="target"
                          value="com.amee.platform.resource.tag.TagResource$Remover"/>
            </bean>
        </property>
    </bean>

    <!-- Drill -->
    <bean id="drillResource" class="com.amee.restlet.resource.GenericResource" scope="prototype">
        <property name="modifiable" value="false"/>
        <property name="attributeNames">
            <set>
                <value>activeUserUid</value>
                <value>categoryIdentifier</value>
            </set>
        </property>
        <property name="builder">
            <bean class="com.amee.base.resource.LocalResourceBuilder">
                <property name="target"
                          value="com.amee.platform.resource.drill.DrillResource$Builder"/>
            </bean>
        </property>
    </bean>

</beans>